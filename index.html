<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Training">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0c0c0e">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="apple-touch-icon" href="favicon.svg">
  <title>Georg â€” Training Plan 2026</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:          #0c0c0e;
      --surface:     #141416;
      --surface-2:   #1c1c1f;
      --border:      rgba(255,255,255,0.07);
      --border-2:    rgba(255,255,255,0.12);
      --amber:       #f0a030;
      --amber-dim:   rgba(240,160,48,0.10);
      --amber-mid:   rgba(240,160,48,0.22);
      --text:        #f0ede8;
      --text-2:      #f0ede8;
      --text-3:      #dddad4;
      --red:         #e05050;
      --cyan:        #38bcd4;
      --green:       #48c878;
      --r:           10px;
    }
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html { scroll-behavior: smooth; }
    button, a, [onclick] { touch-action: manipulation; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 14px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }

    /* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .site-header {
      padding: 28px 20px 0;
      max-width: 860px;
      margin: 0 auto;
    }
    .header-row {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 12px;
    }
    .site-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(36px, 8vw, 52px);
      letter-spacing: 3px;
      line-height: 1;
      color: var(--text);
    }
    .site-title em { color: var(--amber); font-style: normal; }
    .header-meta {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      color: var(--text-2);
      text-align: right;
      line-height: 1.7;
    }
    .header-rule {
      height: 1px;
      background: var(--border);
      margin-top: 18px;
    }

    /* â”€â”€ DAY TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tabs-wrap {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(12,12,14,0.96);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--border);
    }
    .tabs-inner {
      max-width: 860px;
      margin: 0 auto;
      padding: 0 16px;
      display: flex;
      overflow-x: auto;
      scrollbar-width: none;
      gap: 2px;
    }
    .tabs-inner::-webkit-scrollbar { display: none; }
    .tab {
      flex-shrink: 0;
      padding: 10px 14px 8px;
      cursor: pointer;
      border-radius: 8px 8px 0 0;
      border-bottom: 2px solid transparent;
      transition: all 0.18s;
    }
    .tab-day {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-3);
      margin-bottom: 3px;
    }
    .tab-name {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 17px;
      letter-spacing: 1.5px;
      color: var(--text-2);
      line-height: 1;
    }
    .tab:hover .tab-name { color: var(--text); }
    .tab.active { border-bottom-color: var(--amber); }
    .tab.active .tab-name { color: var(--amber); }
    .tab.active .tab-day { color: rgba(240,160,48,0.55); }
    .tab.today .tab-day { color: var(--green) !important; }

    /* â”€â”€ TODAY BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .today-row { margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap; }
    .today-btn, .complete-btn {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.18s;
    }
    .today-btn {
      background: rgba(72,200,120,0.08);
      border: 1px solid rgba(72,200,120,0.28);
      color: var(--green);
    }
    .today-btn:hover, .today-btn:active { background: rgba(72,200,120,0.18); }
    .today-btn.is-today {
      background: rgba(72,200,120,0.18);
      border-color: var(--green);
      font-weight: 600;
    }
    .complete-btn {
      background: rgba(240,160,48,0.08);
      border: 1px solid rgba(240,160,48,0.25);
      color: var(--amber);
    }
    .complete-btn:hover, .complete-btn:active { background: rgba(240,160,48,0.18); }

    /* â”€â”€ PROGRESS PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .prog-summary {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1px;
      background: var(--border);
      border: 1px solid var(--border);
      border-radius: var(--r);
      overflow: hidden;
      margin-bottom: 24px;
    }
    .ps-item {
      background: var(--surface);
      padding: 16px 12px;
      text-align: center;
    }
    .ps-val {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 36px;
      color: var(--amber);
      line-height: 1;
    }
    .ps-lbl {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      color: var(--text-3);
      margin-top: 4px;
    }
    .prog-ex-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      overflow: hidden;
      margin-bottom: 10px;
    }
    .prog-card-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px 8px;
      gap: 12px;
    }
    .prog-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      flex: 1;
    }
    .prog-day-tag {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--amber);
      background: var(--amber-dim);
      border: 1px solid var(--amber-mid);
      padding: 3px 8px;
      border-radius: 4px;
      flex-shrink: 0;
    }
    /* â”€â”€ DELOAD BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .deload-banner {
      background: rgba(240,160,48,0.08);
      border: 1px solid rgba(240,160,48,0.3);
      border-left: 3px solid var(--amber);
      border-radius: var(--r);
      padding: 14px 16px;
      margin-bottom: 20px;
    }
    .deload-title {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--amber);
      margin-bottom: 5px;
    }
    .deload-desc { font-size: 14px; color: var(--text-2); line-height: 1.55; }

    /* â”€â”€ COMBINED CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .combo-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      overflow: hidden;
      margin-bottom: 20px;
    }
    .combo-card-head {
      padding: 14px 16px 8px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-3);
    }
    .combo-svg-wrap { padding: 0 16px 8px; }
    .combo-svg { width: 100%; height: 160px; display: block; }
    .combo-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      padding: 8px 16px 14px;
      border-top: 1px solid var(--border);
    }
    .legend-item { display: flex; align-items: center; gap: 6px; }
    .legend-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .legend-name { font-size: 13px; color: var(--text-2); }

    /* â”€â”€ WEEKLY VOLUME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .vol-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      overflow: hidden;
      margin-bottom: 20px;
    }
    .vol-card-head {
      padding: 14px 16px 10px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-3);
    }
    .vol-row {
      display: flex;
      align-items: center;
      padding: 6px 16px;
      gap: 10px;
    }
    .vol-row + .vol-row { border-top: 1px solid var(--border); }
    .vol-label {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      color: var(--text-2);
      width: 72px;
      flex-shrink: 0;
    }
    .vol-bar-wrap { flex: 1; height: 10px; background: var(--surface-2); border-radius: 5px; overflow: hidden; }
    .vol-bar { height: 100%; border-radius: 5px; transition: width 0.4s ease; }
    .vol-num {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      color: var(--text-3);
      width: 38px;
      text-align: right;
      flex-shrink: 0;
    }

    /* â”€â”€ PER-EXERCISE EXPANDABLE CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .spark-wrap { padding: 0 16px 2px; cursor: pointer; }
    .spark-thumb .spark-svg { width: 100%; height: 48px; display: block; }
    .spark-full { display: none; }
    .spark-wrap.expanded .spark-thumb { display: none; }
    .spark-wrap.expanded .spark-full { display: block; }
    .full-chart-svg { width: 100%; height: 160px; display: block; }
    .spark-axis {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 2px 0 8px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      color: var(--text-3);
    }
    .spark-hint { opacity: 0.5; font-size: 11px; }
    .prog-stats-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 0;
      border-top: 1px solid var(--border);
    }
    .prog-stat {
      text-align: center;
      padding: 12px 8px 10px;
    }
    .prog-stat + .prog-stat { border-left: 1px solid var(--border); }
    .prog-stat-val {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 20px;
      font-weight: 500;
      color: var(--text);
      line-height: 1.2;
    }
    .prog-stat-val.up   { color: var(--green); }
    .prog-stat-val.down { color: var(--red); }
    .prog-stat-lbl {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--text-3);
      margin-top: 3px;
    }
    .prog-suggestion {
      padding: 9px 16px;
      font-size: 12px;
      font-family: 'IBM Plex Mono', monospace;
      color: var(--green);
      background: rgba(72,200,120,0.07);
      border-top: 1px solid rgba(72,200,120,0.14);
    }
    .prog-empty {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-3);
      font-size: 15px;
      line-height: 1.7;
    }

    /* â”€â”€ COMPLETION TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%) translateY(12px);
      background: var(--green);
      color: #0c0c0e;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      letter-spacing: 1px;
      font-weight: 600;
      padding: 11px 22px;
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 300;
      white-space: nowrap;
      pointer-events: none;
    }
    #toast.toast-show { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .main {
      max-width: 860px;
      margin: 0 auto;
      padding: 28px 20px 80px;
    }
    .day-panel { display: none; animation: fadeIn 0.22s ease; }
    .day-panel.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; } }

    /* â”€â”€ DAY HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .day-head { margin-bottom: 24px; }
    .day-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(48px, 12vw, 72px);
      letter-spacing: 4px;
      line-height: 1;
      margin-bottom: 8px;
    }
    .day-meta {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
    }
    .pill {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      letter-spacing: 1px;
      text-transform: uppercase;
      padding: 3px 10px;
      border-radius: 20px;
    }
    .pill-strength { background: rgba(224,80,80,0.12); color: var(--red);   border: 1px solid rgba(224,80,80,0.28); }
    .pill-cardio   { background: rgba(56,188,212,0.12); color: var(--cyan);  border: 1px solid rgba(56,188,212,0.28); }
    .pill-recovery { background: rgba(72,200,120,0.12); color: var(--green); border: 1px solid rgba(72,200,120,0.28); }
    .pill-rest     { background: rgba(80,80,80,0.12);   color: var(--text-3);border: 1px solid rgba(80,80,80,0.2); }
    .day-focus { font-size: 15px; color: var(--text-2); }
    .day-dur {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      color: var(--text);
      margin-left: auto;
    }

    /* â”€â”€ WARMUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .warmup {
      background: var(--surface);
      border: 1px solid var(--border);
      border-left: 3px solid var(--amber);
      border-radius: var(--r);
      padding: 14px 16px;
      margin-bottom: 22px;
    }
    .warmup-lbl {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--amber);
      margin-bottom: 6px;
    }
    .warmup-text { font-size: 14px; color: var(--text-2); line-height: 1.55; }

    /* â”€â”€ SECTION LABEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sec-label {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--text-3);
      margin: 22px 0 10px;
    }
    .sec-label:first-of-type { margin-top: 0; }

    /* â”€â”€ FINISHER DIVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .finisher-div {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 24px 0 12px;
    }
    .finisher-line { flex: 1; height: 1px; background: var(--amber-mid); }
    .finisher-lbl {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--amber);
    }

    /* â”€â”€ EXERCISE LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ex-list { display: flex; flex-direction: column; gap: 6px; }

    /* â”€â”€ EXERCISE CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ex-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      overflow: hidden;
      cursor: pointer;
      transition: border-color 0.18s;
    }
    .ex-card:hover { border-color: rgba(240,160,48,0.3); }
    .ex-card.priority { border-left: 3px solid var(--amber); }

    /* main row */
    .ex-row {
      display: flex;
      align-items: center;
      min-height: 76px;
    }

    /* thumbnail */
    .ex-thumb {
      width: 80px;
      height: 76px;
      flex-shrink: 0;
      position: relative;
      overflow: hidden;
      background: #2e2e32;
    }
    .ex-thumb img {
      position: absolute;
      inset: 0;
      z-index: 1;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      opacity: 0.92;
      filter: brightness(1.35) contrast(1.05);
      transition: opacity 0.2s, filter 0.2s;
    }
    .ex-card:hover .ex-thumb img { opacity: 1; filter: brightness(1.5) contrast(1.05); }

    /* placeholder */
    .ex-ph {
      position: absolute;
      inset: 0;
      z-index: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 3px;
    }
    .ex-ph-icon { font-size: 22px; line-height: 1; }
    .ex-ph-lbl {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 9px;
      letter-spacing: 1px;
      opacity: 0.45;
    }

    /* info area */
    .ex-info {
      flex: 1;
      padding: 0 10px 0 12px;
      min-width: 0;
    }
    .ex-name {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 16px;
      letter-spacing: 1px;
      line-height: 1.15;
      color: var(--text);
      margin-bottom: 2px;
    }
    /* prominent weight row â€” shown when weight is set */
    .ex-my-wt-row { display: none; margin-bottom: 2px; }
    .ex-card.has-wt .ex-my-wt-row { display: flex; align-items: baseline; gap: 5px; }
    .ex-card.has-wt .ex-plan-wt { display: none; }
    .ex-my-wt {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 20px;
      font-weight: 500;
      color: var(--green);
      line-height: 1;
    }
    .ex-my-wt-unit {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      color: rgba(72,200,120,0.6);
    }
    .ex-priority-dot {
      display: inline-block;
      width: 6px; height: 6px;
      background: var(--amber);
      border-radius: 50%;
      margin-left: 6px;
      margin-bottom: 2px;
      vertical-align: middle;
    }
    .ex-mini-stats {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    .ms {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      color: var(--text-2);
      white-space: nowrap;
    }
    .ms.amber { color: var(--amber); }
    .equip-badge {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.5px;
      padding: 2px 6px;
      border-radius: 4px;
      border: 1px solid;
      white-space: nowrap;
    }

    /* right controls */
    .ex-right {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 0 10px;
      flex-shrink: 0;
    }
    .guide-btn {
      display: inline-flex;
      align-items: center;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      color: var(--amber);
      text-decoration: none;
      padding: 5px 9px;
      border: 1px solid var(--amber-mid);
      border-radius: 5px;
      background: var(--amber-dim);
      white-space: nowrap;
      transition: all 0.18s;
    }
    .guide-btn:hover {
      background: rgba(240,160,48,0.2);
      border-color: rgba(240,160,48,0.55);
    }
    .ex-arrow {
      font-size: 12px;
      color: var(--text-3);
      transition: transform 0.18s;
      padding: 4px 2px;
    }
    .ex-card.open .ex-arrow { transform: rotate(180deg); }

    /* detail panel */
    .ex-detail {
      display: none;
      padding: 10px 12px 12px 12px;
      border-top: 1px solid var(--border);
    }
    .ex-card.open .ex-detail { display: block; }
    .ex-note {
      font-size: 14px;
      color: var(--text-2);
      line-height: 1.65;
    }
    .ex-note strong { color: var(--amber); }
    .rpe-note {
      display: inline-block;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      color: var(--red);
      background: rgba(224,80,80,0.1);
      border: 1px solid rgba(224,80,80,0.25);
      border-radius: 4px;
      padding: 2px 7px;
      margin-top: 8px;
    }

    /* â”€â”€ ZONE CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .zone-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 16px;
      margin-bottom: 16px;
      cursor: pointer;
    }
    .zone-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 18px;
      letter-spacing: 2px;
      color: var(--text-3);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0;
    }
    .zone-arrow { font-size: 14px; transition: transform 0.2s; }
    .zone-card.open .zone-arrow { transform: rotate(180deg); }
    .zone-card .zones { display: none; margin-top: 14px; flex-direction: column; gap: 6px; }
    .zone-card.open .zones { display: flex; }
    .z-row { display: flex; align-items: center; gap: 10px; }
    .z-bar {
      flex: 1;
      height: 30px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      padding: 0 12px;
    }
    .z-bar span {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.5px;
    }
    .z-bpm {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      color: var(--text-2);
      width: 86px;
      text-align: right;
      flex-shrink: 0;
    }
    .z1 .z-bar { background: rgba(72,200,120,0.14); border: 1px solid rgba(72,200,120,0.3); }
    .z1 .z-bar span { color: var(--green); }
    .z2 .z-bar { background: rgba(56,188,212,0.14); border: 1px solid rgba(56,188,212,0.3); }
    .z2 .z-bar span { color: var(--cyan); }
    .z3 .z-bar { background: rgba(240,200,56,0.14); border: 1px solid rgba(240,200,56,0.3); }
    .z3 .z-bar span { color: #f0c838; }
    .z4 .z-bar { background: rgba(240,120,40,0.14); border: 1px solid rgba(240,120,40,0.3); }
    .z4 .z-bar span { color: #f07828; }
    .z5 .z-bar { background: rgba(224,80,80,0.14); border: 1px solid rgba(224,80,80,0.3); }
    .z5 .z-bar span { color: var(--red); }

    /* â”€â”€ CARDIO BLOCKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .cardio-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 16px;
      margin-bottom: 8px;
    }
    .cardio-head {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 18px;
      letter-spacing: 1.5px;
      color: var(--cyan);
      margin-bottom: 12px;
    }
    .c-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 7px 0;
      border-bottom: 1px solid var(--border);
    }
    .c-row:last-child { border-bottom: none; }
    .c-lbl { font-size: 13px; color: var(--text); }
    .c-val {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      color: var(--cyan);
      text-align: right;
    }
    .cardio-tip {
      background: rgba(56,188,212,0.07);
      border: 1px solid rgba(56,188,212,0.18);
      border-radius: 8px;
      padding: 12px 14px;
      margin-bottom: 14px;
      font-size: 13px;
      color: var(--text-2);
      line-height: 1.65;
    }

    /* â”€â”€ CORE CIRCUIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .core-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 16px;
    }
    .core-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .core-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 18px;
      letter-spacing: 1.5px;
      color: var(--text);
    }
    .rounds-badge {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      color: var(--amber);
      background: var(--amber-dim);
      border: 1px solid var(--amber-mid);
      padding: 3px 9px;
      border-radius: 4px;
    }
    .core-sub {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      color: var(--text-3);
      margin-bottom: 12px;
    }
    .c-ex {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
    }
    .c-ex:last-child { border-bottom: none; }
    .c-ex-thumb {
      width: 52px; height: 56px;
      border-radius: 6px;
      overflow: hidden;
      flex-shrink: 0;
      background: rgba(200,192,48,0.10);
    }
    .c-ex-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; opacity: 0.75; }
    .c-ex-body { flex: 1; min-width: 0; }
    .c-ex-right { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; flex-shrink: 0; }
    .c-ex-name { font-size: 13px; color: var(--text); }
    .c-ex-sub { font-size: 13px; color: var(--text-3); margin-top: 2px; }
    .c-ex-reps {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      color: var(--cyan);
      white-space: nowrap;
      margin-left: 12px;
    }

    /* â”€â”€ RECOVERY ACTIVITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .rec-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 16px;
      margin-bottom: 8px;
    }
    .rec-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
    .rec-name {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 19px;
      letter-spacing: 1px;
    }
    .rec-dur {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      color: var(--green);
    }
    .rec-zone {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      color: var(--green);
      margin-bottom: 6px;
    }
    .rec-desc { font-size: 14px; color: var(--text-2); line-height: 1.55; }

    /* â”€â”€ REST DAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .rest-block {
      text-align: center;
      padding: 72px 20px 48px;
    }
    .rest-word {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(72px, 20vw, 120px);
      letter-spacing: 10px;
      color: var(--surface-2);
      line-height: 1;
      margin-bottom: 20px;
    }
    .rest-sub { font-size: 15px; color: var(--text-3); margin-bottom: 24px; }
    .rest-list {
      display: inline-flex;
      flex-direction: column;
      gap: 10px;
      text-align: left;
    }
    .rest-item {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      color: var(--text-2);
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .rest-item::before { content: 'â€”'; color: var(--amber); }

    /* â”€â”€ PROGRESSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .prog-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 16px;
      margin-top: 24px;
    }
    .prog-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 19px;
      letter-spacing: 2px;
      color: var(--text);
      margin-bottom: 14px;
    }
    .prog-row {
      display: flex;
      gap: 12px;
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
      align-items: flex-start;
    }
    .prog-row:last-child { border-bottom: none; }
    .prog-dot { width: 8px; height: 8px; border-radius: 50%; margin-top: 5px; flex-shrink: 0; }
    .prog-text { font-size: 14px; color: var(--text-2); line-height: 1.55; }
    .prog-text strong { color: var(--text); }

    /* â”€â”€ DONE TRACKING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ex-check {
      width: 36px;
      height: 76px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .ex-check-btn {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid var(--border-2);
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.18s;
      font-size: 13px;
      color: transparent;
      cursor: pointer;
      flex-shrink: 0;
    }
    .ex-check-btn:hover { border-color: var(--green); color: rgba(72,200,120,0.4); }
    .ex-card.done .ex-check-btn {
      background: var(--green);
      border-color: var(--green);
      color: #0c0c0e;
    }
    .ex-card.done { opacity: 0.45; }
    .ex-card.done .ex-name { text-decoration: line-through; }

    .day-reset {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--text-2);
      background: none;
      border: 1px solid var(--border-2);
      border-radius: 4px;
      padding: 3px 9px;
      cursor: pointer;
      transition: all 0.18s;
    }
    .day-reset:hover { color: var(--text); border-color: rgba(255,255,255,0.3); }

    /* â”€â”€ WEIGHT TRACKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .wt-section {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }
    .wt-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .wt-lbl {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--green);
    }
    .wt-plan {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      color: var(--text-3);
    }
    /* drum wheel weight picker */
    .wt-drum-outer {
      position: relative;
      height: 144px;
      overflow: hidden;
      margin-bottom: 10px;
      border-radius: 10px;
      background: var(--surface-2);
      border: 1px solid var(--border-2);
    }
    .wt-drum {
      height: 100%;
      overflow-y: scroll;
      scroll-snap-type: y mandatory;
      scrollbar-width: none;
      -ms-overflow-style: none;
      overscroll-behavior-y: contain;
    }
    .wt-drum::-webkit-scrollbar { display: none; }
    .drum-item {
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      scroll-snap-align: center;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 20px;
      font-weight: 400;
      color: var(--text-3);
      user-select: none;
    }
    .drum-item.selected {
      color: var(--green);
      font-size: 24px;
      font-weight: 600;
    }
    .drum-fade-top, .drum-fade-bot {
      position: absolute;
      left: 0; right: 0;
      height: 52px;
      pointer-events: none;
      z-index: 2;
    }
    .drum-fade-top {
      top: 0;
      background: linear-gradient(to bottom, var(--surface-2) 20%, transparent);
    }
    .drum-fade-bot {
      bottom: 0;
      background: linear-gradient(to top, var(--surface-2) 20%, transparent);
    }
    .drum-center-band {
      position: absolute;
      left: 16px; right: 16px;
      top: 50%; transform: translateY(-50%);
      height: 48px;
      border-top: 1px solid var(--border-2);
      border-bottom: 1px solid var(--border-2);
      pointer-events: none;
      z-index: 1;
    }
    .wt-last {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 6px;
    }
    .wt-last-lbl {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-3);
    }
    .wt-last-val {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      color: var(--text-2);
    }
    .wt-suggest {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      color: var(--green);
      background: rgba(72,200,120,0.1);
      border: 1px solid rgba(72,200,120,0.25);
      border-radius: 4px;
      padding: 2px 8px;
    }
    .wt-empty { font-size: 13px; color: var(--text-3); font-style: italic; margin-top: 6px; }
    /* note section divider */
    .ex-note-wrap {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    @media (max-width: 640px) {
      /* â”€â”€ Compact header â”€â”€ */
      .site-header { padding: 12px 16px 0; }
      .site-title { font-size: 26px; letter-spacing: 2px; }
      .header-meta { display: none; }
      .header-rule { margin-top: 10px; }

      /* â”€â”€ Bottom tab bar â”€â”€ */
      .tabs-wrap {
        position: fixed;
        top: auto; bottom: 0; left: 0; right: 0;
        border-top: 1px solid var(--border-2);
        border-bottom: none;
        padding-bottom: env(safe-area-inset-bottom);
      }
      .tabs-inner { padding: 4px 0 0; justify-content: space-around; gap: 0; }
      .tab {
        flex: 1; text-align: center;
        padding: 6px 2px 8px;
        border-bottom: none; border-top: 2px solid transparent;
        border-radius: 0; min-width: 0;
      }
      .tab.active { border-top-color: var(--amber); border-bottom-color: transparent; }
      .tab-day  { font-size: 10px; letter-spacing: 1px; }
      .tab-name { font-size: 15px; letter-spacing: 1px; }

      /* â”€â”€ Main padding â”€â”€ */
      .main { padding: 16px 12px calc(74px + env(safe-area-inset-bottom)) 12px; }

      /* â”€â”€ Day header â”€â”€ */
      .day-title { font-size: 44px; }
      .day-meta { gap: 6px; }
      .day-focus { font-size: 15px; }
      .day-dur { display: none; }
      .pill { font-size: 11px; padding: 4px 12px; }

      /* â”€â”€ Section labels â”€â”€ */
      .sec-label { font-size: 12px; margin: 18px 0 8px; }
      .finisher-lbl { font-size: 12px; }

      /* â”€â”€ Warmup â”€â”€ */
      .warmup { padding: 12px 14px; }
      .warmup-lbl { font-size: 11px; }
      .warmup-text { font-size: 15px; line-height: 1.6; }

      /* â”€â”€ Exercise cards â”€â”€ */
      .ex-list { gap: 6px; }
      .ex-row { min-height: 72px; }
      .ex-thumb { width: 68px; height: 72px; }
      .ex-check { width: 44px; height: 72px; }
      .ex-check-btn { width: 32px; height: 32px; font-size: 16px; }
      .ex-info { padding: 0 6px 0 10px; }
      .ex-name { font-size: 17px; }
      .ex-my-wt { font-size: 22px; }
      .ms { font-size: 14px; }
      .ex-right { padding: 0 8px; }
      .guide-btn { display: none; }

      /* â”€â”€ Expanded card detail â”€â”€ */
      .ex-detail { padding: 14px; }
      .ex-note { font-size: 15px; line-height: 1.7; }
      .ex-note-wrap .guide-btn { display: inline-flex; font-size: 13px; padding: 8px 14px; }
      .rpe-note { font-size: 13px; padding: 4px 10px; }

      /* â”€â”€ Weight tracker â”€â”€ */
      .wt-lbl  { font-size: 12px; }
      .wt-plan { font-size: 13px; }
      .wt-last-lbl { font-size: 12px; }
      .wt-last-val { font-size: 14px; }
      .wt-suggest  { font-size: 13px; padding: 4px 10px; }
      .wt-empty    { font-size: 13px; }

      /* â”€â”€ Heart rate zones â”€â”€ */
      .zone-title { font-size: 16px; }
      .z-bar span { font-size: 13px; }
      .z-bpm { font-size: 13px; }

      /* â”€â”€ Cardio â”€â”€ */
      .cardio-head { font-size: 18px; }
      .c-lbl { font-size: 15px; }
      .c-val { font-size: 14px; }
      .cardio-tip { font-size: 14px; line-height: 1.7; }

      /* â”€â”€ Core circuit â”€â”€ */
      .core-title { font-size: 18px; }
      .core-sub { font-size: 12px; }
      .rounds-badge { font-size: 12px; }
      .c-ex-name { font-size: 15px; }
      .c-ex-sub { font-size: 13px; }
      .c-ex-reps { font-size: 14px; }

      /* â”€â”€ Recovery â”€â”€ */
      .rec-name { font-size: 19px; }
      .rec-zone { font-size: 12px; }
      .rec-desc { font-size: 15px; line-height: 1.65; }

      /* â”€â”€ Rest day â”€â”€ */
      .rest-sub { font-size: 15px; }
      .rest-item { font-size: 15px; }

      /* â”€â”€ Progression â”€â”€ */
      .prog-card { margin-top: 16px; }
      .prog-title { font-size: 18px; }
      .prog-text { font-size: 15px; line-height: 1.6; }

      /* â”€â”€ Day reset button â”€â”€ */
      .day-reset { font-size: 12px; padding: 5px 12px; }

      /* â”€â”€ Progress page â”€â”€ */
      .ps-val { font-size: 28px; }
      .ps-lbl { font-size: 9px; }
      .prog-name { font-size: 16px; }
      .prog-stat-val { font-size: 18px; }
      .prog-stat-lbl { font-size: 9px; }
      .prog-suggestion { font-size: 13px; }
      .combo-svg { height: 140px; }
      .full-chart-svg { height: 140px; }
      .legend-name { font-size: 12px; }
      .vol-label { font-size: 11px; width: 64px; }
      .deload-desc { font-size: 14px; }

      /* â”€â”€ Today / complete buttons â”€â”€ */
      .today-row { gap: 8px; }
      .today-btn, .complete-btn { flex: 1; padding: 13px 8px; font-size: 12px; text-align: center; }

      /* â”€â”€ Toast â”€â”€ */
      #toast { bottom: calc(80px + env(safe-area-inset-bottom)); font-size: 13px; white-space: normal; text-align: center; max-width: 80vw; }
    }
  </style>
</head>
<body>

<header class="site-header">
  <div class="header-row">
    <div class="site-title">GEORG<em>'S</em> PLAN</div>
    <div class="header-meta">51 yrs Â· 185 cm Â· 82 kg<br>Intermediate Â· Strength First</div>
  </div>
  <div class="header-rule"></div>
</header>

<nav class="tabs-wrap">
  <div class="tabs-inner" id="tabs"></div>
</nav>

<main class="main" id="main"></main>

<script>
// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â”€â”€â”€ MUSCLE GROUP ICONS (shown when no thumbnail is available) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MUSCLE_ICONS = {
  chest:     { icon: 'ğŸ«€', color: '#e05050', label: 'Chest' },
  shoulders: { icon: 'ğŸ’ª', color: '#f0a030', label: 'Shoulder' },
  triceps:   { icon: 'ğŸ’ª', color: '#d06020', label: 'Triceps' },
  back:      { icon: 'ğŸ”°', color: '#38bcd4', label: 'Back' },
  biceps:    { icon: 'ğŸ’ª', color: '#3890e0', label: 'Biceps' },
  legs:      { icon: 'ğŸ¦µ', color: '#48c878', label: 'Legs' },
  calves:    { icon: 'ğŸ¦µ', color: '#30a858', label: 'Calves' },
  core:      { icon: 'âš¡', color: '#c8c030', label: 'Core' },
};
const EX_MUSCLE = {
  'Barbell Bench Press':           'chest',
  'Cable Lateral Raise':           'shoulders',
  'Overhead Press':                'shoulders',
  'Incline Dumbbell Press':        'chest',
  'Dumbbell Lateral Raise':        'shoulders',
  'Tricep Pushdown':               'triceps',
  'Conventional Deadlift':         'back',
  'Bent-over Barbell Row':         'back',
  'Lat Pulldown':                  'back',
  'Seated Cable Row':              'back',
  'Incline Dumbbell Bicep Curl':   'biceps',
  'Barbell Back Squat':            'legs',
  'Romanian Deadlift':             'legs',
  'Leg Press':                     'legs',
  'Leg Curl':                      'legs',
  'Calf Raises':                   'calves',
  'Face Pulls':                    'shoulders',
  'Cable Chest Fly / Pec Deck':    'chest',
  'Pull-ups':                      'back',
  'Dumbbell Shoulder Press':       'shoulders',
  'Lean-away Cable Lateral Raise': 'shoulders',
  'Reverse Pec Deck':              'shoulders',
  'Single-arm Dumbbell Row':       'back',
  'Hammer Curls':                  'biceps',
  'Overhead Tricep Extension':     'triceps',
  'Pallof Press':                  'core',
  'Ab Wheel Rollout':              'core',
  'Dead Bugs':                     'core',
  'Plank':                         'core',
  'Bird Dog':                      'core',
};

const EX_EQUIP = {
  'Barbell Bench Press':           'barbell',
  'Overhead Press':                'barbell',
  'Conventional Deadlift':         'barbell',
  'Bent-over Barbell Row':         'barbell',
  'Barbell Back Squat':            'barbell',
  'Romanian Deadlift':             'barbell',
  'Incline Dumbbell Press':        'dumbbell',
  'Dumbbell Lateral Raise':        'dumbbell',
  'Incline Dumbbell Bicep Curl':   'dumbbell',
  'Dumbbell Shoulder Press':       'dumbbell',
  'Single-arm Dumbbell Row':       'dumbbell',
  'Hammer Curls':                  'dumbbell',
  'Cable Lateral Raise':           'cable',
  'Lean-away Cable Lateral Raise': 'cable',
  'Tricep Pushdown':               'cable',
  'Seated Cable Row':              'cable',
  'Face Pulls':                    'cable',
  'Cable Chest Fly / Pec Deck':    'cable',
  'Overhead Tricep Extension':     'cable',
  'Pallof Press':                  'cable',
  'Lat Pulldown':                  'machine',
  'Leg Press':                     'machine',
  'Leg Curl':                      'machine',
  'Calf Raises':                   'machine',
  'Reverse Pec Deck':              'machine',
  'Pull-ups':                      'bar',
  'Ab Wheel Rollout':              'floor',
  'Dead Bugs':                     'floor',
  'Plank':                         'floor',
  'Bird Dog':                      'floor',
};
const EQUIP_BADGE = {
  barbell:  { label:'BARBELL',  color:'#f0a030', bg:'rgba(240,160,48,0.12)'  },
  dumbbell: { label:'DUMBBELL', color:'#e07840', bg:'rgba(224,120,64,0.12)'  },
  cable:    { label:'CABLE',    color:'#38bcd4', bg:'rgba(56,188,212,0.12)'  },
  machine:  { label:'MACHINE',  color:'#48c878', bg:'rgba(72,200,120,0.12)'  },
  bar:      { label:'BAR',      color:'#b870e8', bg:'rgba(184,112,232,0.12)' },
  floor:    { label:'FLOOR',    color:'#908c88', bg:'rgba(144,140,136,0.10)' },
};

// Images for exercise thumbnails.
// Values starting with "http" are used as direct image URLs.
// All other values are treated as YouTube video IDs â†’ img.youtube.com/vi/ID/hqdefault.jpg
const THUMB = {
  // YouTube video IDs â€” all confirmed from fitness sites
  'Barbell Bench Press':           'ZyjQar-XgBc',
  'Cable Lateral Raise':           'ufrFCjERMDc',
  'Lean-away Cable Lateral Raise': 'ufrFCjERMDc',
  'Dumbbell Lateral Raise':        'ufrFCjERMDc',
  'Single-arm Dumbbell Row':       'YZgVEy6cmaY',
  'Incline Dumbbell Press':        'hChjZQhX1Ls',
  'Bent-over Barbell Row':         'ykP1VnofdIQ',
  'Incline Dumbbell Bicep Curl':   'U4pq-nAI_JQ',
  'Tricep Pushdown':               '_w-HpW70nSQ',
  'Dumbbell Shoulder Press':       'FRxZ6wr5bpA',
  'Hammer Curls':                  '8XLxfXROrTo',
  'Overhead Tricep Extension':     'NRENeEgaIgA',
  'Leg Curl':                      '3BWiLFc8Dbg',
  'Calf Raises':                   'RBslMmWqzzE',
  'Face Pulls':                    'VdnHXklRQW8',
  // Wikimedia Commons â€” confirmed photo URLs (no SVGs)
  'Conventional Deadlift':         'https://upload.wikimedia.org/wikipedia/commons/thumb/6/63/Deadlift-phase_1.JPG/500px-Deadlift-phase_1.JPG',
  'Overhead Press':                'https://upload.wikimedia.org/wikipedia/commons/thumb/6/62/Seated-military-shoulder-press-1.png/500px-Seated-military-shoulder-press-1.png',
  'Lat Pulldown':                  'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Diverging_Lat_Pulldown_Machine.jpg/500px-Diverging_Lat_Pulldown_Machine.jpg',
  'Seated Cable Row':              'https://upload.wikimedia.org/wikipedia/commons/thumb/0/0a/Woman_using_a_seated_cable_row_machine_at_the_gym.jpg/500px-Woman_using_a_seated_cable_row_machine_at_the_gym.jpg',
  'Barbell Back Squat':            'https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/Unilateral_barbell_back_squat_squatting.jpg/500px-Unilateral_barbell_back_squat_squatting.jpg',
  'Romanian Deadlift':             'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e8/Romanian-deadlift-1.png/500px-Romanian-deadlift-1.png',
  'Leg Press':                     'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/Young_man_using_a_leg_press_machine_at_the_gym.jpg/500px-Young_man_using_a_leg_press_machine_at_the_gym.jpg',
  'Cable Chest Fly / Pec Deck':    'https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/Cable-crossover-1.png/500px-Cable-crossover-1.png',
  'Pull-ups':                      'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/Pull-ups_exercise_from_back.jpg/500px-Pull-ups_exercise_from_back.jpg',
  'Reverse Pec Deck':              'https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/Pec_deck_Fly.jpg/500px-Pec_deck_Fly.jpg',
  'Plank':                         'TvxNkmjdhMM',
  'Dead Bugs':                     '4XLEnwUr1d8',
  'Bird Dog':                      'wptcd5i-bFo',
  'Pallof Press':                  '2h_cMboLYKc',
};

function thumb(name) {
  const val = THUMB[name];
  if (!val) return null;
  if (val.startsWith('http')) return val;
  return `https://img.youtube.com/vi/${val}/hqdefault.jpg`;
}

const ICONS = {
  chest: 'ğŸ‹', shoulders: 'ğŸ’ª', triceps: 'ğŸ’ª', back: 'ğŸ”™',
  biceps: 'ğŸ’ª', legs: 'ğŸ¦µ', core: 'âš¡', cardio: 'â¤ï¸'
};

const DAYS = [
  {
    id: 'mon', short: 'D1', name: 'PUSH',
    focus: 'Chest Â· Shoulders Â· Triceps',
    type: 'strength', dur: '~60 min',
    warmup: 'Arm circles Ã—20 Â· Band pull-aparts Ã—15 Â· 2 warm-up sets on bench at 40% and 60% of working weight',
    sections: [
      { label: 'Main Lifts', exercises: [
        { name:'Barbell Bench Press',  sets:4, reps:'5',  rest:'3 min',  kg:'60â€“75 kg',   lbs:'132â€“165 lbs',  rpe:'RPE 9', priority:true,
          note:'Bar touches chest, press explosively. Work up to RPE 9 on set 4.',
          guide:'https://www.youtube.com/results?search_query=barbell+bench+press+proper+form' },
        { name:'Cable Lateral Raise', sets:4, reps:'15', rest:'60 sec', kg:'7.5â€“12.5 kg', lbs:'16â€“27 lbs/side', priority:true,
          note:'<strong>Slow up (2 sec), slow down (3 sec). No swinging.</strong> This is how width gets built. Pulley set to lowest position.',
          guide:'https://exrx.net/WeightExercises/DeltoidLateral/CBLateralRaise' },
        { name:'Overhead Press',       sets:4, reps:'5',  rest:'3 min',  kg:'40â€“55 kg',   lbs:'88â€“121 lbs',   rpe:'RPE 9',
          note:'Barbell in squat rack or Smith machine. Full lockout overhead, brace core before every rep.',
          guide:'https://exrx.net/WeightExercises/DeltoidAnterior/BBMilitaryPress' },
      ]},
      { label: 'Accessories', exercises: [
        { name:'Incline Dumbbell Press',  sets:3, reps:'10', rest:'90 sec', kg:'22â€“28 kg', lbs:'48â€“62 lbs/hand',
          note:'Bench at 30â€“45 degrees. 2-second controlled lowering on every rep.',
          guide:'https://www.youtube.com/results?search_query=incline+dumbbell+press+proper+form' },
        { name:'Dumbbell Lateral Raise',  sets:3, reps:'12', rest:'60 sec', kg:'8â€“12 kg',  lbs:'18â€“26 lbs/hand',
          note:'Slight forward lean, lead with elbows not wrists. Drop the weight if you have to swing.',
          guide:'https://www.youtube.com/results?search_query=dumbbell+lateral+raise+proper+form' },
        { name:'Tricep Pushdown',         sets:3, reps:'12', rest:'60 sec', kg:'20â€“30 kg', lbs:'44â€“66 lbs',
          note:'High cable pulley, straight bar or rope. Elbows pinned at sides, squeeze at the bottom.',
          guide:'https://www.youtube.com/results?search_query=cable+tricep+pushdown+proper+form' },
      ]},
    ]
  },
  {
    id: 'tue', short: 'D2', name: 'PULL',
    focus: 'Back Â· Biceps',
    type: 'strength', dur: '~55 min',
    warmup: 'Shoulder rotations Ã—20 Â· Cat-cow Ã—10 Â· 2 light sets lat pulldown at 40% of working weight',
    sections: [
      { label: 'Main Lifts', exercises: [
        { name:'Conventional Deadlift',   sets:4, reps:'5',  rest:'4 min',  kg:'90â€“110 kg', lbs:'198â€“243 lbs', rpe:'RPE 9', priority:true,
          note:'<strong>Hinge â€” not a squat.</strong> Bar stays over mid-foot throughout. Best hormonal stimulus of the week.',
          guide:'https://exrx.net/WeightExercises/ErectorSpinae/BBDeadlift' },
        { name:'Bent-over Barbell Row',   sets:4, reps:'5',  rest:'3 min',  kg:'60â€“75 kg',  lbs:'132â€“165 lbs', rpe:'RPE 9', priority:true,
          note:'Torso nearly parallel to floor. Pull bar to lower ribs â€” not to chest.',
          guide:'https://www.youtube.com/results?search_query=bent+over+barbell+row+proper+form' },
      ]},
      { label: 'Accessories', exercises: [
        { name:'Lat Pulldown',            sets:3, reps:'10', rest:'90 sec', kg:'55â€“70 kg', lbs:'121â€“154 lbs',
          note:'Wide grip bar. Full stretch at top. Pull to upper chest â€” never behind neck.',
          guide:'https://www.youtube.com/results?search_query=lat+pulldown+proper+form' },
        { name:'Seated Cable Row',        sets:3, reps:'12', rest:'90 sec', kg:'50â€“65 kg', lbs:'110â€“143 lbs',
          note:'Low pulley, V-bar or wide bar. Hold the squeeze at full contraction for 1 second.',
          guide:'https://www.youtube.com/results?search_query=seated+cable+row+proper+form' },
        { name:'Incline Dumbbell Bicep Curl', sets:3, reps:'12', rest:'60 sec', kg:'12â€“16 kg', lbs:'26â€“35 lbs/hand',
          note:'Bench at 60 degrees. Arms hang behind the body at the bottom â€” this stretches the bicep more than a standing curl.',
          guide:'https://www.youtube.com/results?search_query=incline+dumbbell+bicep+curl+proper+form' },
      ]},
    ]
  },
  {
    id: 'wed', short: 'D3', name: 'RECOVERY',
    focus: 'Active Rest',
    type: 'recovery', dur: '~55 min',
    recovery: true,
    activities: [
      { name:'Walk or Easy Bike', dur:'30â€“40 min', zone:'Zone 1 Â· below 130 bpm',
        desc:'Fully conversational pace. This moves waste products out of muscles and cuts next-day soreness. No effort â€” if you feel your heart rate climbing, slow down.' },
      { name:'Foam Rolling',      dur:'15 min', zone:null,
        desc:'Lats, thoracic spine, quads, hamstrings. 45 seconds per area, slow and deliberate â€” not rolling fast.' },
      { name:'Mobility Work',     dur:'10 min', zone:null,
        desc:'Hip circles, shoulder CARs (controlled articular rotations), spinal rotation. Stay below 130 bpm for the entire day.' },
    ]
  },
  {
    id: 'thu', short: 'D4', name: 'LEGS',
    focus: 'Quads Â· Hamstrings Â· Glutes + Shoulder Finisher',
    type: 'strength', dur: '~70 min',
    warmup: 'Leg swings Ã—20 each side Â· 10 bodyweight squats Â· 10 goblet squats (light KB) Â· 2 warm-up sets on squat at 40% and 60%',
    sections: [
      { label: 'Main Lifts', exercises: [
        { name:'Barbell Back Squat', sets:4, reps:'5',  rest:'4 min',  kg:'70â€“90 kg',   lbs:'154â€“198 lbs',  rpe:'RPE 9', priority:true,
          note:'Most important movement in the plan â€” drives full-body strength. Squat rack, barbell at shoulder height.',
          guide:'https://www.youtube.com/results?search_query=barbell+back+squat+proper+form' },
        { name:'Romanian Deadlift', sets:4, reps:'6',  rest:'3 min',  kg:'60â€“80 kg',   lbs:'132â€“176 lbs',
          note:'Push hips back until you feel the hamstring pull. <strong>Lower back stays neutral</strong> â€” it never rounds.',
          guide:'https://www.youtube.com/results?search_query=romanian+deadlift+proper+form' },
      ]},
      { label: 'Machine Work', exercises: [
        { name:'Leg Press',  sets:3, reps:'10', rest:'90 sec', kg:'90â€“130 kg', lbs:'198â€“286 lbs',
          note:'Large reclined sled machine. Feet shoulder-width. Full range â€” stop just before knees lock at top.',
          guide:'https://www.youtube.com/results?search_query=leg+press+machine+proper+form' },
        { name:'Leg Curl',   sets:3, reps:'12', rest:'90 sec', kg:'35â€“50 kg',  lbs:'77â€“110 lbs',
          note:'Seated or lying machine, either works. <strong>3-second lowering on every rep</strong> â€” this is where the growth happens.',
          guide:'https://www.youtube.com/results?search_query=leg+curl+machine+proper+form' },
        { name:'Calf Raises', sets:4, reps:'15', rest:'60 sec', kg:'50â€“70 kg',  lbs:'110â€“154 lbs',
          note:'Full stretch at bottom (heel below platform level), 1-second pause at top.',
          guide:'https://www.youtube.com/results?search_query=standing+calf+raises+proper+form' },
      ]},
      { label: 'Shoulder Finisher', finisher:true, exercises: [
        { name:'Cable Lateral Raise', sets:3, reps:'15', rest:'60 sec', kg:'7.5â€“12.5 kg', lbs:'16â€“27 lbs', priority:true,
          note:'Legs are done â€” upper body is completely fresh. Third lateral delt stimulus of the week. Low cable pulley.',
          guide:'https://exrx.net/WeightExercises/DeltoidLateral/CBLateralRaise' },
        { name:'Face Pulls',          sets:3, reps:'15', rest:'60 sec', kg:'15â€“22.5 kg',  lbs:'33â€“50 lbs',  priority:true,
          note:'Cable machine, rope attachment, pulley at face height. Pull rope to forehead, elbows flare wide. Key for rear delt and shoulder health.',
          guide:'https://www.youtube.com/results?search_query=face+pulls+cable+proper+form' },
      ]},
    ]
  },
  {
    id: 'fri', short: 'D5', name: 'CARDIO',
    focus: 'Cardio Â· Core',
    type: 'cardio', dur: '~55 min',
    cardio: true,
    blocks: [
      { title:'HIIT BLOCK', items:[
        { l:'Equipment', v:'ğŸš´ Stationary bike &nbsp;Â·&nbsp; ğŸš£ Rowing machine' },
        { l:'Warm-up',   v:'5 min Â· Zone 1 Â· below 130 bpm' },
        { l:'Intervals', v:'10 Ã— (30 sec all-out / 90 sec easy)' },
        { l:'Work HR',   v:'Zone 4â€“5 Â· 152â€“170 bpm Â· 5 min total' },
        { l:'Rest HR',   v:'Zone 2 Â· 130â€“141 bpm Â· 15 min total' },
        { l:'Total',     v:'~20 min' },
      ]},
      { title:'STEADY STATE', items:[
        { l:'Duration', v:'10â€“15 min' },
        { l:'Zone',     v:'Zone 2 Â· 130â€“141 bpm' },
        { l:'Feel',     v:'Conversational â€” full sentences' },
      ]},
    ],
    core: {
      rounds: '3 ROUNDS',
      note: 'No rest between exercises Â· 90 sec rest between rounds',
      exercises: [
        { name:'Plank',              reps:'45 sec',   note:'Hips level, squeeze glutes and abs simultaneously. Posterior pelvic tilt -- no sagging lower back' },
        { name:'Dead Bugs',          reps:'12 reps',  note:'Lower back pressed to floor throughout. Most important exercise for lumbar stability and back health' },
        { name:'Bird Dog',           reps:'10 / side',note:'Opposite arm + leg, hold 2 sec at top. Directly trains the spinal stabilisers that protect the lower back' },
        { name:'Pallof Press',       reps:'10 / side',note:'Cable at chest height, stand sideways to machine. Resist rotation -- core works hardest when you resist, not when you move' },
      ]
    }
  },
  {
    id: 'sat', short: 'D6', name: 'UPPER',
    focus: 'Full Upper Â· Hypertrophy',
    type: 'strength', dur: '~65 min',
    warmup: 'Light cable fly Ã—15 Â· Arm circles Ã—20 Â· 1 warm-up set on each major movement',
    sections: [
      { label: 'Chest & Back', exercises: [
        { name:'Cable Chest Fly / Pec Deck', sets:3, reps:'12', rest:'75 sec', kg:'35â€“50 kg',  lbs:'77â€“110 lbs/side',
          note:'Pec deck machine (arm pads) OR cable machine with D-handles at chest height. Feel the stretch at full extension.',
          guide:'https://exrx.net/WeightExercises/PectoralSternal/LVPecDeckFly' },
        { name:'Pull-ups',                   sets:3, reps:'10', rest:'90 sec', kg:'Bodyweight', lbs:'âˆ’10â€“20 kg assist if needed',
          note:'Full hang at the bottom, chin over bar at the top. Use the assisted pull-up machine if needed.',
          guide:'https://www.youtube.com/results?search_query=pull+ups+proper+form' },
        { name:'Single-arm Dumbbell Row',    sets:3, reps:'12', rest:'75 sec', kg:'24â€“32 kg',  lbs:'53â€“71 lbs',
          note:'Knee and hand on bench. Pull elbow to ceiling â€” not out to the side.',
          guide:'https://www.youtube.com/results?search_query=single+arm+dumbbell+row+proper+form' },
      ]},
      { label: 'Shoulder Width Priority', exercises: [
        { name:'Dumbbell Shoulder Press',        sets:3, reps:'12', rest:'75 sec', kg:'18â€“24 kg',    lbs:'40â€“53 lbs/hand', priority:true,
          note:'Sit on upright bench. Slightly wider grip than barbell â€” activates more side delt.',
          guide:'https://www.youtube.com/results?search_query=seated+dumbbell+shoulder+press+proper+form' },
        { name:'Lean-away Cable Lateral Raise',  sets:4, reps:'15', rest:'60 sec', kg:'7.5â€“12.5 kg', lbs:'16â€“27 lbs',      priority:true,
          note:'Single low cable. Grip the upright with your free hand and lean away from the machine. Better range of motion than standing upright.',
          guide:'https://exrx.net/WeightExercises/DeltoidLateral/CBLateralRaise' },
        { name:'Reverse Pec Deck',               sets:3, reps:'15', rest:'60 sec', kg:'15â€“25 kg',    lbs:'33â€“55 lbs/side', priority:true,
          note:'<strong>Same machine as pec deck â€” sit facing INTO it.</strong> Grab the handles from behind. Adds roundness to shoulder. Key for shoulder balance.',
          guide:'https://www.youtube.com/results?search_query=reverse+pec+deck+rear+delt+proper+form' },
        { name:'Face Pulls',                     sets:3, reps:'15', rest:'60 sec', kg:'15â€“22.5 kg',  lbs:'33â€“50 lbs',
          note:'Never skip this. Rope attachment, pulley at face height, pull to forehead with elbows flared wide. Protects the shoulder joint.',
          guide:'https://www.youtube.com/results?search_query=face+pulls+cable+proper+form' },
      ]},
      { label: 'Arms', exercises: [
        { name:'Hammer Curls',              sets:3, reps:'12', rest:'60 sec', kg:'14â€“18 kg',   lbs:'31â€“40 lbs/hand',
          note:'Neutral grip (palms face each other). Hits the brachialis â€” adds thickness to the arm.',
          guide:'https://www.youtube.com/results?search_query=hammer+curls+proper+form' },
        { name:'Overhead Tricep Extension', sets:3, reps:'12', rest:'60 sec', kg:'15â€“22.5 kg', lbs:'33â€“50 lbs',
          note:'Cable rope overhead, or single dumbbell held with both hands. Elbows stay close to head throughout.',
          guide:'https://www.youtube.com/results?search_query=overhead+tricep+extension+cable+rope+proper+form' },
      ]},
    ]
  },
  {
    id: 'sun', short: 'D7', name: 'REST',
    focus: 'Full Rest',
    type: 'rest', dur: null,
    rest: true
  }
];

// â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function zoneChart() {
  return `
    <div class="zone-card" onclick="this.classList.toggle('open')">
      <div class="zone-title">APPLE WATCH Â· HEART RATE ZONES <span class="zone-arrow">â–¾</span></div>
      <div class="zones">
        <div class="z-row z1"><div class="z-bar"><span>Z1 Â· Very easy</span></div><div class="z-bpm">below 130 bpm</div></div>
        <div class="z-row z2"><div class="z-bar"><span>Z2 Â· Aerobic base</span></div><div class="z-bpm">130â€“141 bpm</div></div>
        <div class="z-row z3"><div class="z-bar"><span>Z3 Â· Aerobic</span></div><div class="z-bpm">141â€“152 bpm</div></div>
        <div class="z-row z4"><div class="z-bar"><span>Z4 Â· Hard effort</span></div><div class="z-bpm">152â€“162 bpm</div></div>
        <div class="z-row z5"><div class="z-bar"><span>Z5 Â· Maximum</span></div><div class="z-bpm">162â€“170+ bpm</div></div>
      </div>
    </div>`;
}

function exCard(ex, dayId) {
  const imgUrl = thumb(ex.name);
  const muscle = EX_MUSCLE[ex.name] || 'chest';
  const mi = MUSCLE_ICONS[muscle] || MUSCLE_ICONS.chest;
  const imgTag = imgUrl
    ? `<img src="${imgUrl}" alt="${ex.name}" loading="lazy" onerror="this.style.display='none'">`
    : '';
  const eq = EX_EQUIP[ex.name];
  const eb = eq ? EQUIP_BADGE[eq] : null;
  const equipTag = eb
    ? `<span class="equip-badge" style="color:${eb.color};background:${eb.bg};border-color:${eb.color}40">${eb.label}</span>`
    : '';

  return `
    <div class="ex-card${ex.priority ? ' priority' : ''}" data-ex="${ex.name}" data-day="${dayId}" onclick="toggle(this)">
      <div class="ex-row">
        <div class="ex-check" onclick="event.stopPropagation();toggleDone(this)">
          <div class="ex-check-btn">âœ“</div>
        </div>
        <div class="ex-thumb">
          <div class="ex-ph" style="background:${mi.color}18">
            <div class="ex-ph-icon">${mi.icon}</div>
            <div class="ex-ph-lbl">${mi.label.toUpperCase()}</div>
          </div>
          ${imgTag}
        </div>
        <div class="ex-info">
          <div class="ex-name">${ex.name}${ex.priority ? '<span class="ex-priority-dot"></span>' : ''}</div>
          <div class="ex-my-wt-row"><span class="ex-my-wt"></span><span class="ex-my-wt-unit">kg</span></div>
          <div class="ex-mini-stats">
            <span class="ms">${ex.sets}Ã—${ex.reps}</span>
            <span class="ms amber ex-plan-wt">${ex.kg}</span>
            <span class="ms">${ex.rest} between sets</span>
            ${equipTag}
          </div>
        </div>
        <div class="ex-right">
          ${ex.guide ? `<a href="${ex.guide}" target="_blank" onclick="event.stopPropagation()" class="guide-btn">SEE MACHINE â†—</a>` : ''}
          <div class="ex-arrow">â–¾</div>
        </div>
      </div>
      <div class="ex-detail">
        <div class="wt-section" data-ex="${ex.name}" data-plan="${ex.kg}">
          <div class="wt-header">
            <span class="wt-lbl">My Weight</span>
            <span class="wt-plan">Plan: ${ex.kg}</span>
          </div>
          <div class="wt-drum-outer" onclick="event.stopPropagation()">
            <div class="drum-fade-top"></div>
            <div class="drum-center-band"></div>
            <div class="drum-fade-bot"></div>
          </div>
          <div class="wt-history"></div>
        </div>
        <div class="ex-note-wrap">
          <div class="ex-note">${ex.note}</div>
          ${ex.rpe ? `<div class="rpe-note">${ex.rpe} on last set</div>` : ''}
          ${ex.guide ? `<a href="${ex.guide}" target="_blank" onclick="event.stopPropagation()" class="guide-btn" style="margin-top:10px;display:inline-flex">SEE MACHINE â†—</a>` : ''}
        </div>
      </div>
    </div>`;
}

function progCard() {
  return `
    <div class="prog-card">
      <div class="prog-title">PROGRESSION RULES</div>
      <div class="prog-row"><div class="prog-dot" style="background:var(--green)"></div><div class="prog-text"><strong>Add 2.5 kg</strong> â€” when all sets are done and the last set felt like 3+ reps left in the tank.</div></div>
      <div class="prog-row"><div class="prog-dot" style="background:var(--amber)"></div><div class="prog-text"><strong>Stay same weight</strong> â€” when all reps were completed but the last set was at the limit.</div></div>
      <div class="prog-row"><div class="prog-dot" style="background:var(--red)"></div><div class="prog-text"><strong>Drop 5%</strong> â€” if a rep failed or form broke down mid-set.</div></div>
      <div class="prog-row"><div class="prog-dot" style="background:var(--text-3)"></div><div class="prog-text"><strong>Deload every 4â€“6 weeks</strong> â€” same movements at 60â€“65% of normal weight. This is when tendons catch up to muscles.</div></div>
    </div>`;
}

function buildPanel(day, isFirst) {
  const el = document.createElement('div');
  el.className = 'day-panel' + (isFirst ? ' active' : '');
  el.dataset.id = day.id;

  const typeLabels = { strength:'Strength', cardio:'Cardio', recovery:'Active Recovery', rest:'Rest' };
  let html = `
    <div class="day-head">
      <div class="day-title">${day.name}</div>
      <div class="day-meta">
        <span class="pill pill-${day.type}">${typeLabels[day.type]}</span>
        <span class="day-focus">${day.focus}</span>
        ${day.dur ? `<span class="day-dur">${day.dur}</span>` : ''}
      ${day.sections ? `<button class="day-reset" onclick="resetDay('${day.id}')">Reset workout</button>` : ''}
      </div>
      <div class="today-row">
        <button class="today-btn" data-day="${day.id}" onclick="setToday('${day.id}')">Train this today</button>
        ${!day.sections ? `<button class="complete-btn" onclick="advanceToNextDay('${day.id}')">Complete day \u2192</button>` : ''}
      </div>
    </div>`;

  if (day.rest) {
    html += `
      <div class="rest-block">
        <div class="rest-word">REST</div>
        <div class="rest-sub">This is when muscles repair and grow.</div>
        <div class="rest-list">
          <div class="rest-item">7â€“9 hours sleep</div>
          <div class="rest-item">160â€“180 g protein today</div>
          <div class="rest-item">2â€“3 litres water</div>
          <div class="rest-item">Optional 20-min walk if stiff â€” no elevated HR</div>
        </div>
      </div>`;

  } else if (day.recovery) {
    html += `
      <div class="rec-card" style="border-left:3px solid var(--green)">
        <div class="rec-head"><div class="rec-name" style="color:var(--green)">Today's Rule</div></div>
        <div class="rec-desc">Stay below 130 bpm (Zone 1) for the entire day. This session moves waste products from muscles and reduces soreness for the next training day.</div>
      </div>`;
    day.activities.forEach(a => {
      html += `
        <div class="rec-card">
          <div class="rec-head"><div class="rec-name">${a.name}</div><div class="rec-dur">${a.dur}</div></div>
          ${a.zone ? `<div class="rec-zone">${a.zone}</div>` : ''}
          <div class="rec-desc">${a.desc}</div>
        </div>`;
    });
    html += zoneChart();

  } else if (day.cardio) {
    day.blocks.forEach(b => {
      html += `<div class="cardio-card"><div class="cardio-head">${b.title}</div>`;
      b.items.forEach(i => { html += `<div class="c-row"><div class="c-lbl">${i.l}</div><div class="c-val">${i.v}</div></div>`; });
      html += `</div>`;
    });
    html += `
      <div class="cardio-tip">
        If you can hold a conversation during all-out intervals, go harder â€” target Zone 4â€“5 (152+ bpm).<br>
        During rest, recover to Zone 2 (130â€“141 bpm) before the next round. If you can't recover in 90 sec, reduce work interval to 20 sec.
      </div>`;
    const cc = day.core;
    html += `
      <div class="core-card">
        <div class="core-head"><div class="core-title">CORE CIRCUIT</div><div class="rounds-badge">${cc.rounds}</div></div>
        <div class="core-sub">${cc.note}</div>`;
    cc.exercises.forEach(e => {
      const imgUrl = thumb(e.name);
      const tid = THUMB[e.name];
      const videoUrl = tid && !tid.startsWith('http') ? `https://www.youtube.com/watch?v=${tid}` : null;
      html += `
        <div class="c-ex">
          <div class="c-ex-thumb">${imgUrl ? `<img src="${imgUrl}" alt="${e.name}" loading="lazy" onerror="this.style.display='none'">` : ''}</div>
          <div class="c-ex-body"><div class="c-ex-name">${e.name}</div><div class="c-ex-sub">${e.note}</div></div>
          <div class="c-ex-right">
            <div class="c-ex-reps">${e.reps}</div>
            ${videoUrl ? `<a href="${videoUrl}" target="_blank" onclick="event.stopPropagation()" class="guide-btn">SEE HOW â†—</a>` : ''}
          </div>
        </div>`;
    });
    html += `</div>`;
    html += zoneChart();

  } else {
    // Strength day
    if (day.warmup) {
      html += `<div class="warmup"><div class="warmup-lbl">Warm-up Â· 5 min</div><div class="warmup-text">${day.warmup}</div></div>`;
    }
    day.sections.forEach(sec => {
      if (sec.finisher) {
        html += `<div class="finisher-div"><div class="finisher-line"></div><div class="finisher-lbl">Shoulder Finisher Â· 8 min</div><div class="finisher-line"></div></div>`;
      } else {
        html += `<div class="sec-label">${sec.label}</div>`;
      }
      html += `<div class="ex-list">`;
      sec.exercises.forEach(ex => { html += exCard(ex, day.id); });
      html += `</div>`;
    });
    html += progCard();
  }

  el.innerHTML = html;
  return el;
}

function toggle(card) {
  card.classList.toggle('open');
  if (card.classList.contains('open')) {
    card.querySelectorAll('.wt-section').forEach(section => {
      buildDrum(section, section.dataset.ex);
    });
  }
}

// â”€â”€ DONE TRACKING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function toggleDone(btn) {
  const card = btn.closest('.ex-card');
  const exName = card.dataset.ex;
  const dayId  = card.dataset.day;
  const isDone = card.classList.toggle('done');
  const key = `done:${dayId}:${exName}`;
  isDone ? localStorage.setItem(key, '1') : localStorage.removeItem(key);
  // Log weight to history when marking done
  if (isDone) {
    const wt = getWt(exName);
    if (wt !== null) {
      logWtHistory(exName, wt);
      const section = card.querySelector('.wt-section');
      if (section) section.querySelector('.wt-history').innerHTML = historyHtml(exName);
    }
    // Auto-advance if this is the current today and all exercises are now done
    if (localStorage.getItem('today') === dayId && allExercisesDone(dayId)) {
      advanceToNextDay(dayId);
    }
  }
}

function allExercisesDone(dayId) {
  const cards = document.querySelectorAll(`.day-panel[data-id="${dayId}"] .ex-card`);
  return cards.length > 0 && [...cards].every(c => c.classList.contains('done'));
}

function showToast(msg) {
  let t = document.getElementById('toast');
  if (!t) { t = document.createElement('div'); t.id = 'toast'; document.body.appendChild(t); }
  t.textContent = msg;
  t.classList.add('toast-show');
  setTimeout(() => t.classList.remove('toast-show'), 2200);
}

function advanceToNextDay(currentDayId) {
  const idx = DAYS.findIndex(d => d.id === currentDayId);
  const next = DAYS[(idx + 1) % DAYS.length];
  showToast('Day complete \u2713  \u2192  ' + next.short + ' Â· ' + next.name);
  setTimeout(() => setToday(next.id), 2000);
}

function loadDone(dayId) {
  document.querySelectorAll(`.day-panel[data-id="${dayId}"] .ex-card`).forEach(card => {
    const key = `done:${dayId}:${card.dataset.ex}`;
    card.classList.toggle('done', !!localStorage.getItem(key));
  });
}

function resetDay(dayId) {
  document.querySelectorAll(`.day-panel[data-id="${dayId}"] .ex-card`).forEach(card => {
    card.classList.remove('done');
    localStorage.removeItem(`done:${dayId}:${card.dataset.ex}`);
  });
}

// â”€â”€ TODAY TRACKING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function updateTodayMarkers(dayId) {
  document.querySelectorAll('.tab').forEach(t => {
    const isToday = t.dataset.id === dayId;
    const dayEl = t.querySelector('.tab-day');
    if (isToday) {
      if (!dayEl.dataset.orig) dayEl.dataset.orig = dayEl.textContent;
      dayEl.textContent = 'TODAY';
    } else if (dayEl.dataset.orig) {
      dayEl.textContent = dayEl.dataset.orig;
    }
    t.classList.toggle('today', isToday);
  });
  document.querySelectorAll('.today-btn').forEach(btn => {
    const isThis = btn.dataset.day === dayId;
    btn.textContent = isThis ? 'Training today \u2713' : 'Train this today';
    btn.classList.toggle('is-today', isThis);
  });
}

function setToday(dayId) {
  localStorage.setItem('today', dayId);
  resetDay(dayId);
  updateTodayMarkers(dayId);
  setDay(dayId);
}

// â”€â”€ WEIGHT TRACKING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function getWt(exName) {
  const v = localStorage.getItem('wt:' + exName);
  return v !== null ? parseFloat(v) : null;
}

function saveWt(exName, weight) {
  localStorage.setItem('wt:' + exName, weight);
}

function getWtHistory(exName) {
  try { return JSON.parse(localStorage.getItem('wth:' + exName) || '[]'); }
  catch { return []; }
}

function logWtHistory(exName, weight) {
  const today = new Date().toISOString().slice(0, 10);
  const hist = getWtHistory(exName);
  if (hist.length > 0 && hist[hist.length - 1].date === today) {
    hist[hist.length - 1].weight = weight; // update same-day entry
  } else {
    hist.push({ date: today, weight });
  }
  localStorage.setItem('wth:' + exName, JSON.stringify(hist));
}

function fmtDate(iso) {
  const d = new Date(iso + 'T12:00:00');
  return d.toLocaleDateString('en', { month: 'short', day: 'numeric' });
}

function wtSuggestion(exName) {
  const hist = getWtHistory(exName);
  if (hist.length < 2) return null;
  const last = hist[hist.length - 1];
  const prev = hist[hist.length - 2];
  // Same weight two sessions in a row â†’ ready to go up
  if (last.weight === prev.weight) return Math.round((last.weight + 2.5) * 10) / 10;
  return null;
}

function historyHtml(exName) {
  const hist = getWtHistory(exName);
  if (hist.length === 0) return '<div class="wt-empty">No sessions yet â€” logged when you tick âœ“ done</div>';
  const last = hist[hist.length - 1];
  const suggest = wtSuggestion(exName);
  const suggestHtml = suggest
    ? `<span class="wt-suggest">â†‘ Try ${suggest} kg</span>`
    : '';
  return `<div class="wt-last">
    <span class="wt-last-lbl">Last</span>
    <span class="wt-last-val">${fmtDate(last.date)} Â· ${last.weight} kg</span>
    ${suggestHtml}
  </div>`;
}

function setCardWt(card, wt) {
  card.classList.add('has-wt');
  const wtEl = card.querySelector('.ex-my-wt');
  if (wtEl) wtEl.textContent = wt;
}

const DRUM_STEP = 0.5, DRUM_MAX = 200, DRUM_H = 48;
const DRUM_CNT  = Math.round(DRUM_MAX / DRUM_STEP) + 1; // 401

function buildDrum(section, exName) {
  const outer = section.querySelector('.wt-drum-outer');
  if (!outer || outer.querySelector('.wt-drum')) return;

  const drum = document.createElement('div');
  drum.className = 'wt-drum';

  // top spacer â€” allows item 0 to center in the 144px viewport
  const ts = document.createElement('div');
  ts.style.cssText = 'height:48px;flex-shrink:0';
  drum.appendChild(ts);

  for (let i = 0; i < DRUM_CNT; i++) {
    const wt = i * DRUM_STEP;
    const div = document.createElement('div');
    div.className = 'drum-item';
    div.textContent = (wt % 1 === 0 ? wt.toFixed(0) : wt.toFixed(1)) + ' kg';
    drum.appendChild(div);
  }

  // bottom spacer
  const bs = document.createElement('div');
  bs.style.cssText = 'height:48px;flex-shrink:0';
  drum.appendChild(bs);

  outer.appendChild(drum);

  const saved = getWt(exName);
  const startWt = saved !== null ? saved : (() => {
    const m = (section.dataset.plan || '').match(/(\d+\.?\d*)/);
    return m ? parseFloat(m[1]) : 0;
  })();
  const startIdx = Math.max(0, Math.min(Math.round(startWt / DRUM_STEP), DRUM_CNT - 1));

  // Set position without animation (element just became visible)
  drum._selIdx = -1;
  requestAnimationFrame(() => {
    drum.style.scrollBehavior = 'auto';
    drum.scrollTop = startIdx * DRUM_H;
    _drumSelect(drum, startIdx);
    requestAnimationFrame(() => { drum.style.scrollBehavior = ''; });
  });

  if (saved !== null) {
    section.querySelector('.wt-history').innerHTML = historyHtml(exName);
    setCardWt(section.closest('.ex-card'), saved);
  }

  let scrollTimer;
  drum.addEventListener('scroll', () => {
    const idx = Math.round(drum.scrollTop / DRUM_H);
    _drumSelect(drum, idx);
    clearTimeout(scrollTimer);
    scrollTimer = setTimeout(() => {
      const wt = idx * DRUM_STEP;
      saveWt(exName, wt);
      section.querySelector('.wt-history').innerHTML = historyHtml(exName);
      setCardWt(section.closest('.ex-card'), wt);
    }, 150);
  }, { passive: true });
}

function _drumSelect(drum, idx) {
  if (drum._selIdx === idx) return;
  // children layout: [spacer, item0, item1, ..., itemN, spacer]
  if (drum._selIdx >= 0) drum.children[drum._selIdx + 1].classList.remove('selected');
  if (idx >= 0 && idx < DRUM_CNT) drum.children[idx + 1].classList.add('selected');
  drum._selIdx = idx;
}

function initWeights(dayId) { /* drums built lazily in toggle() */ }

// â”€â”€ PROGRESS PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function sparklineSVG(hist) {
  if (hist.length < 2) return '';
  const W = 300, H = 48;
  const weights = hist.map(h => h.weight);
  const min = Math.min(...weights);
  const max = Math.max(...weights);
  const range = max - min || 1;
  const px = 4, py = 6;
  const cx = (i) => px + (i / (hist.length - 1)) * (W - px * 2);
  const cy = (w) => py + (1 - (w - min) / range) * (H - py * 2);

  let d = `M ${cx(0).toFixed(1)},${cy(weights[0]).toFixed(1)}`;
  for (let i = 1; i < hist.length; i++) {
    const x1 = cx(i-1), y1 = cy(weights[i-1]);
    const x2 = cx(i),   y2 = cy(weights[i]);
    const mx = (x1 + x2) / 2;
    d += ` C ${mx.toFixed(1)},${y1.toFixed(1)} ${mx.toFixed(1)},${y2.toFixed(1)} ${x2.toFixed(1)},${y2.toFixed(1)}`;
  }
  const area = d + ` L ${cx(hist.length-1).toFixed(1)},${H} L ${cx(0).toFixed(1)},${H} Z`;
  const dots = hist.map((h, i) =>
    `<circle cx="${cx(i).toFixed(1)}" cy="${cy(h.weight).toFixed(1)}" r="${hist.length <= 10 ? 3 : 0}" fill="var(--green)"/>`
  ).join('');
  return `<svg class="spark-svg" viewBox="0 0 ${W} ${H}" preserveAspectRatio="none">
    <path d="${area}" fill="rgba(72,200,120,0.10)"/>
    <path d="${d}" fill="none" stroke="var(--green)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" opacity="0.85"/>
    ${dots}
  </svg>`;
}

function fullChartSVG(hist) {
  if (hist.length < 2) return '';
  const W = 280, H = 160;
  const pL = 42, pR = 10, pT = 14, pB = 26;
  const cW = W - pL - pR, cH = H - pT - pB;
  const weights = hist.map(h => h.weight);
  const minW = Math.min(...weights), maxW = Math.max(...weights);
  const step = (maxW - minW) <= 10 ? 2.5 : (maxW - minW) <= 30 ? 5 : 10;
  const gMin = Math.floor(minW / step) * step;
  const gMax = Math.ceil(maxW / step) * step;
  const gRange = gMax - gMin || step;
  const cx = i => pL + (i / (hist.length - 1)) * cW;
  const cy = w => pT + (1 - (w - gMin) / gRange) * cH;

  let path = `M ${cx(0).toFixed(1)},${cy(weights[0]).toFixed(1)}`;
  for (let i = 1; i < hist.length; i++) {
    const [x1,y1,x2,y2] = [cx(i-1),cy(weights[i-1]),cx(i),cy(weights[i])];
    const mx = (x1+x2)/2;
    path += ` C ${mx.toFixed(1)},${y1.toFixed(1)} ${mx.toFixed(1)},${y2.toFixed(1)} ${x2.toFixed(1)},${y2.toFixed(1)}`;
  }
  const area = path + ` L ${cx(hist.length-1).toFixed(1)},${pT+cH} L ${cx(0).toFixed(1)},${pT+cH} Z`;

  let grid = '', yLbls = '';
  for (let w = gMin; w <= gMax + 0.01; w += step) {
    const y = cy(w).toFixed(1);
    grid  += `<line x1="${pL}" y1="${y}" x2="${W-pR}" y2="${y}" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>`;
    yLbls += `<text x="${pL-5}" y="${(parseFloat(y)+3.5).toFixed(1)}" text-anchor="end" fill="rgba(200,196,190,0.55)" font-size="10" font-family="IBM Plex Mono,monospace">${w}</text>`;
  }

  const xIdx = hist.length <= 4 ? hist.map((_,i)=>i) : [0, Math.floor((hist.length-1)/2), hist.length-1];
  const xLbls = [...new Set(xIdx)].map(i => {
    const lbl = fmtDate(hist[i].date);
    const anchor = i === 0 ? 'start' : i === hist.length-1 ? 'end' : 'middle';
    return `<text x="${cx(i).toFixed(1)}" y="${H-4}" text-anchor="${anchor}" fill="rgba(200,196,190,0.45)" font-size="10" font-family="IBM Plex Mono,monospace">${lbl}</text>`;
  }).join('');

  const dots = hist.map((h, i) => {
    const x = cx(i).toFixed(1), y = cy(h.weight).toFixed(1);
    const r = i === hist.length-1 ? 4 : 2.5;
    const fill = i === hist.length-1 ? 'var(--green)' : 'rgba(72,200,120,0.65)';
    const showLbl = i === 0 || i === hist.length-1 || hist.length <= 5;
    return `<circle cx="${x}" cy="${y}" r="${r}" fill="${fill}"/>`
      + (showLbl ? `<text x="${x}" y="${(parseFloat(y)-7).toFixed(1)}" text-anchor="middle" fill="rgba(200,196,190,0.75)" font-size="10" font-family="IBM Plex Mono,monospace">${h.weight}</text>` : '');
  }).join('');

  return `<svg class="full-chart-svg" viewBox="0 0 ${W} ${H}">
    ${grid}
    <path d="${area}" fill="rgba(72,200,120,0.09)"/>
    <path d="${path}" fill="none" stroke="var(--green)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    ${yLbls}${xLbls}${dots}
  </svg>`;
}

function combinedChartSVG(exs) {
  const valid = exs.filter(e => e.hist.length >= 2);
  if (valid.length === 0) return '';
  const W = 300, H = 160;
  const pL = 10, pR = 10, pT = 10, pB = 28;
  const cW = W - pL - pR, cH = H - pT - pB;
  // Normalise to % of starting weight so different exercises are comparable
  const cx = (pct, total) => pL + (pct / (total-1)) * cW;
  const cy = pct => pT + (1 - (pct - 100) / Math.max(...valid.flatMap(e => {
    const f = e.hist[0].weight; return e.hist.map(h => (h.weight/f*100)-100);
  }), 1)) * cH;

  // Recalculate y-scale properly
  const allPcts = valid.flatMap(e => { const f = e.hist[0].weight; return e.hist.map(h => h.weight/f*100); });
  const minP = Math.floor(Math.min(...allPcts) / 5) * 5;
  const maxP = Math.ceil(Math.max(...allPcts) / 5) * 5;
  const pRange = maxP - minP || 10;
  const pyFn = p => pT + (1 - (p - minP) / pRange) * cH;

  const COLORS = ['#f0a030','#38bcd4','#48c878','#e05050','#b870e8','#e07840','#40c0b0','#e0a060'];
  let grid = '';
  const step = pRange <= 15 ? 5 : 10;
  for (let p = minP; p <= maxP; p += step) {
    const y = pyFn(p).toFixed(1);
    grid += `<line x1="${pL}" y1="${y}" x2="${W-pR}" y2="${y}" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>`;
    if (p === 100) grid += `<line x1="${pL}" y1="${y}" x2="${W-pR}" y2="${y}" stroke="rgba(255,255,255,0.15)" stroke-width="1"/>`;
  }
  const xLbls = `<text x="${pL}" y="${H-4}" text-anchor="start" fill="rgba(200,196,190,0.4)" font-size="9" font-family="IBM Plex Mono,monospace">start</text>
    <text x="${W-pR}" y="${H-4}" text-anchor="end" fill="rgba(200,196,190,0.4)" font-size="9" font-family="IBM Plex Mono,monospace">latest</text>`;

  let lines = '';
  valid.forEach((ex, ei) => {
    const color = COLORS[ei % COLORS.length];
    const base = ex.hist[0].weight;
    const pts = ex.hist.map((h, i) => ({
      x: (pL + (i / (ex.hist.length-1)) * cW).toFixed(1),
      y: pyFn(h.weight / base * 100).toFixed(1)
    }));
    let d = `M ${pts[0].x},${pts[0].y}`;
    for (let i = 1; i < pts.length; i++) {
      const mx = ((parseFloat(pts[i-1].x)+parseFloat(pts[i].x))/2).toFixed(1);
      d += ` C ${mx},${pts[i-1].y} ${mx},${pts[i].y} ${pts[i].x},${pts[i].y}`;
    }
    const last = pts[pts.length-1];
    lines += `<path d="${d}" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" opacity="0.85"/>`;
    lines += `<circle cx="${last.x}" cy="${last.y}" r="3.5" fill="${color}"/>`;
  });

  return { svg: `<svg class="combo-svg" viewBox="0 0 ${W} ${H}">${grid}${lines}${xLbls}</svg>`, colors: COLORS };
}

function weeklyVolumeHTML(tracked) {
  const vol = {};
  Object.keys(MUSCLE_ICONS).forEach(m => { vol[m] = 0; });
  tracked.forEach(ex => {
    const m = EX_MUSCLE[ex.name]; if (!m) return;
    const w = ex.hist[ex.hist.length-1].weight;
    const reps = parseInt(ex.reps) || 10;
    vol[m] = (vol[m] || 0) + ex.sets * reps * w;
  });
  const entries = Object.entries(vol).filter(([,v]) => v > 0).sort((a,b) => b[1]-a[1]);
  if (entries.length === 0) return '';
  const maxV = entries[0][1];
  const rows = entries.map(([m, v]) => {
    const mi = MUSCLE_ICONS[m];
    const pct = (v / maxV * 100).toFixed(0);
    const label = Math.round(v) >= 1000 ? `${(v/1000).toFixed(1)}k` : Math.round(v);
    return `<div class="vol-row">
      <div class="vol-label">${mi.label}</div>
      <div class="vol-bar-wrap"><div class="vol-bar" style="width:${pct}%;background:${mi.color}40;border-right:2px solid ${mi.color}"></div></div>
      <div class="vol-num">${label}</div>
    </div>`;
  }).join('');
  return `<div class="vol-card"><div class="vol-card-head">Weekly Volume Â· sets Ã— reps Ã— kg</div>${rows}</div>`;
}

function deloadBanner(tracked) {
  const cutoff = new Date(); cutoff.setDate(cutoff.getDate()-42);
  const cutStr = cutoff.toISOString().slice(0,10);
  const dates = new Set(tracked.flatMap(e => e.hist.filter(h => h.date >= cutStr).map(h => h.date)));
  if (dates.size < 20) return '';
  return `<div class="deload-banner">
    <div class="deload-title">Deload week due</div>
    <div class="deload-desc">${dates.size} training days in the last 6 weeks. Drop to 60â€“65% of normal weights this week. Tendons and ligaments catch up to muscles during deload.</div>
  </div>`;
}

function toggleExChart(wrap, exName) {
  const isExpanded = wrap.classList.toggle('expanded');
  if (isExpanded) {
    const fullEl = wrap.querySelector('.spark-full');
    if (!fullEl.dataset.built) {
      fullEl.innerHTML = fullChartSVG(getWtHistory(exName));
      fullEl.dataset.built = '1';
    }
  }
}

function progressCard(ex) {
  const hist = ex.hist;
  const cur   = hist[hist.length - 1].weight;
  const first = hist[0].weight;
  const delta = Math.round((cur - first) * 10) / 10;
  const dStr  = delta > 0 ? `+${delta}` : `${delta}`;
  const dCls  = delta > 0 ? 'up' : delta < 0 ? 'down' : '';
  const suggest = wtSuggestion(ex.name);
  const safeName = ex.name.replace(/\\/g,'\\\\').replace(/'/g,"\\'");

  const chart = hist.length >= 2 ? `
    <div class="spark-wrap" onclick="toggleExChart(this,'${safeName}')">
      <div class="spark-thumb">${sparklineSVG(hist)}</div>
      <div class="spark-full"></div>
      <div class="spark-axis">
        <span>${fmtDate(hist[0].date)}</span>
        <span class="spark-hint">tap to expand</span>
        <span>${fmtDate(hist[hist.length-1].date)}</span>
      </div>
    </div>` : '';

  return `
    <div class="prog-ex-card">
      <div class="prog-card-head">
        <div class="prog-name">${ex.name}</div>
        <div class="prog-day-tag">${ex.dayShort}</div>
      </div>
      ${chart}
      <div class="prog-stats-row">
        <div class="prog-stat"><div class="prog-stat-val">${cur}</div><div class="prog-stat-lbl">Current kg</div></div>
        <div class="prog-stat"><div class="prog-stat-val ${dCls}">${dStr}</div><div class="prog-stat-lbl">Progress kg</div></div>
        <div class="prog-stat"><div class="prog-stat-val">${hist.length}</div><div class="prog-stat-lbl">Sessions</div></div>
      </div>
      ${suggest ? `<div class="prog-suggestion">â†‘ Try ${suggest} kg next session</div>` : ''}
    </div>`;
}

function buildProgressHTML() {
  const tracked = [];
  const seen = new Set();
  DAYS.forEach(day => {
    if (!day.sections) return;
    day.sections.forEach(sec => {
      sec.exercises.forEach(ex => {
        if (seen.has(ex.name)) return;
        const hist = getWtHistory(ex.name);
        if (hist.length > 0) {
          seen.add(ex.name);
          tracked.push({ ...ex, dayShort: day.short, dayName: day.name, dayId: day.id, hist });
        }
      });
    });
  });

  if (tracked.length === 0) {
    return `<div class="day-head"><div class="day-title">STATS</div></div>
      <div class="prog-empty">No progress data yet.<br>Log weights and mark exercises done<br>to see your progress here.</div>`;
  }

  const totalSessions = tracked.reduce((s, e) => s + e.hist.length, 0);
  const bestGain = tracked.reduce((b, e) => {
    const g = e.hist[e.hist.length-1].weight - e.hist[0].weight;
    return g > b.g ? { g, label: `+${Math.round(g*10)/10}` } : b;
  }, { g: -Infinity, label: 'â€”' });

  const summary = `
    <div class="prog-summary">
      <div class="ps-item"><div class="ps-val">${tracked.length}</div><div class="ps-lbl">Exercises</div></div>
      <div class="ps-item"><div class="ps-val">${totalSessions}</div><div class="ps-lbl">Sessions</div></div>
      <div class="ps-item"><div class="ps-val">${bestGain.g > 0 ? bestGain.label : 'â€”'}</div><div class="ps-lbl">Best gain</div></div>
    </div>`;

  // Combined chart â€” all exercises with 2+ sessions, % of starting weight
  const COLORS = ['#f0a030','#38bcd4','#48c878','#e05050','#b870e8','#e07840','#40c0b0','#e0a060'];
  const forCombo = tracked.filter(e => e.hist.length >= 2).slice(0, 8);
  let comboSection = '';
  if (forCombo.length >= 2) {
    const result = combinedChartSVG(forCombo);
    const legend = forCombo.map((ex, i) => {
      const base = ex.hist[0].weight, cur = ex.hist[ex.hist.length-1].weight;
      const pct = Math.round((cur/base - 1) * 100);
      const sign = pct >= 0 ? '+' : '';
      return `<div class="legend-item"><span class="legend-dot" style="background:${COLORS[i % COLORS.length]}"></span><span class="legend-name">${ex.name} <span style="opacity:.55">${sign}${pct}%</span></span></div>`;
    }).join('');
    comboSection = `<div class="combo-card">
      <div class="combo-card-head">All exercises Â· % of starting weight</div>
      <div class="combo-svg-wrap">${result.svg}</div>
      <div class="combo-legend">${legend}</div>
    </div>`;
  }

  const volumeSection = weeklyVolumeHTML(tracked);
  const deload = deloadBanner(tracked);

  let cards = '';
  DAYS.forEach(day => {
    if (!day.sections) return;
    const exs = tracked.filter(e => e.dayId === day.id);
    if (exs.length === 0) return;
    cards += `<div class="sec-label">${day.short} Â· ${day.name}</div>`;
    exs.forEach(ex => { cards += progressCard(ex); });
  });

  return `<div class="day-head"><div class="day-title">STATS</div></div>
    ${deload}${summary}${comboSection}${cards}${volumeSection}`;
}

function showProgress() {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.day-panel').forEach(p => p.classList.remove('active'));
  document.getElementById('tab-progress').classList.add('active');
  const panel = document.getElementById('panel-progress');
  panel.classList.add('active');
  panel.innerHTML = buildProgressHTML();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function setDay(id) {
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.id === id));
  document.querySelectorAll('.day-panel').forEach(p => p.classList.toggle('active', p.dataset.id === id));
  loadDone(id);
  initWeights(id);
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tabs = document.getElementById('tabs');
const main = document.getElementById('main');

DAYS.forEach((day, i) => {
  const tab = document.createElement('div');
  tab.className = 'tab' + (i === 0 ? ' active' : '');
  tab.dataset.id = day.id;
  tab.innerHTML = `<div class="tab-day">${day.short}</div><div class="tab-name">${day.name}</div>`;
  tab.addEventListener('click', () => setDay(day.id));
  tabs.appendChild(tab);
  main.appendChild(buildPanel(day, i === 0));
});

// Progress tab + panel
const progTab = document.createElement('div');
progTab.className = 'tab';
progTab.id = 'tab-progress';
progTab.dataset.id = 'progress';
progTab.innerHTML = `<div class="tab-day">PRG</div><div class="tab-name">STATS</div>`;
progTab.addEventListener('click', showProgress);
tabs.appendChild(progTab);
const progPanel = document.createElement('div');
progPanel.className = 'day-panel';
progPanel.id = 'panel-progress';
progPanel.dataset.id = 'progress';
main.appendChild(progPanel);

// Restore "today" from last session; otherwise default to first day
const savedToday = localStorage.getItem('today');
if (savedToday && DAYS.find(d => d.id === savedToday)) {
  updateTodayMarkers(savedToday);
  setDay(savedToday);
} else {
  loadDone(DAYS[0].id);
  initWeights(DAYS[0].id);
}
</script>
</body>
</html>
